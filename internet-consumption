#/bin/bash
LANG=C
OUTPUTDIR=/var/www/html/vnstat
vnstat=$(which vnstat)
if [[ $vnstat == "" ]]; then
	echo "$0: vnstat is not installed."
	exit
fi
vnstati=$(which vnstati) # don't blame if it is not installed, this is optional
for iface in $(ifconfig | grep "Link encap" | awk -F" " '{print $1}'); do
	if [[ $iface != "lo" ]]; then
		echo "Processing $iface";
		$vnstat -i $iface > $OUTPUTDIR/vnstat_$iface.txt
#		errcnt=$OUTPUTDIR/vnstat_$iface.txt | grep Error | wc -l
#		echo errcnt = $errcnt
		if [[ $vnstati != "" ]]; then
			$vnstati -i $iface -s -o $OUTPUTDIR/vnstat_$iface.png
		fi
		if [[ $? == "0" ]]; then
			for unit in hours days months; do
				FILENAME=$OUTPUTDIR/vnstat~$iface~$unit
				FILENAME=$(sed "s/~/_/g" <<< "$FILENAME")
				echo $FILENAME
				$vnstat -i $iface --$unit > $FILENAME.txt
				if [[ $vnstati != "" ]]; then
					$vnstati -i $iface --$unit -ru -o $FILENAME.png
				fi
			done
		fi
	fi
done
